{"ast":null,"code":"import React,{useState}from\"react\";import\"./DownloaderForm.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function DownloaderForm(_ref){let{platform,setPreviewUrl,setPreviewFormat}=_ref;const[input,setInput]=useState(\"\");const[media,setMedia]=useState(null);const[loading,setLoading]=useState(false);const[normalized,setNormalized]=useState(\"\");// keep the normalized URL we used for preview\nconst normalizeYouTube=url=>{let u=url.trim().split(\"?\")[0].replace(/\\/$/,\"\");if(/\\/shorts\\/([^\\/]+)/.test(u))return\"https://www.youtube.com/watch?v=\".concat(u.match(/\\/shorts\\/([^\\/]+)/)[1]);if(/youtu\\.be\\/([^\\/]+)/.test(u))return\"https://www.youtube.com/watch?v=\".concat(u.match(/youtu\\.be\\/([^\\/]+)/)[1]);return u;};const onPreview=async()=>{if(!input.trim())return alert(\"Please paste a valid link.\");setLoading(true);setMedia(null);setPreviewUrl(\"\");setPreviewFormat(\"\");try{let url=input;if(platform===\"youtube\")url=normalizeYouTube(url);setNormalized(url);// remember the exact URL used for backend calls\nconst res=await fetch(\"http://localhost:3001/api/\".concat(platform,\"?url=\").concat(encodeURIComponent(url)));const json=await res.json();if(!res.ok||json.error)throw new Error(json.error||\"Preview fetch failed\");// Use unified (FastDL-like) response\nsetMedia(json);if(json.can_preview&&json.preview_url){setPreviewUrl(json.preview_url);setPreviewFormat(json.type===\"video\"?\"mp4\":\"jpg\");}}catch(e){alert(e.message||\"Preview failed\");}finally{setLoading(false);}};const onDownload=()=>{if(!media)return;if(platform===\"instagram\"){// Always use the original post URL we normalized earlier\nconst postUrl=normalized||input.trim();if(!postUrl){alert(\"No Instagram post URL available.\");return;}const a=document.createElement(\"a\");a.href=\"http://localhost:3001/api/instagram/download?url=\".concat(encodeURIComponent(postUrl),\"&filename=instagram\");a.setAttribute(\"download\",\"\");document.body.appendChild(a);a.click();a.remove();}else if(platform===\"youtube\"){// Use the normalized URL we previewed to ensure the backend merges video+audio\nconst pageUrl=normalized||normalizeYouTube(input);const a=document.createElement(\"a\");a.href=\"http://localhost:3001/api/youtube/download?url=\".concat(encodeURIComponent(pageUrl),\"&title=InstantSaver\");a.setAttribute(\"download\",\"\");document.body.appendChild(a);a.click();a.remove();}};return/*#__PURE__*/_jsxs(\"div\",{className:\"downloader-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-row\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:platform===\"instagram\"?\"Paste Instagram link\":\"Paste YouTube link\",value:input,onChange:e=>setInput(e.target.value),className:\"input-box\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn primary\",onClick:onPreview,disabled:loading,children:loading?\"Loading...\":\"Preview\"})]}),media&&/*#__PURE__*/_jsxs(\"div\",{className:\"media-preview\",children:[media.type===\"video\"?media.can_preview?/*#__PURE__*/_jsxs(\"video\",{controls:true,className:\"media-element\",children:[/*#__PURE__*/_jsx(\"source\",{src:media.preview_url,type:\"video/mp4\"}),\"Your browser does not support the video tag.\"]}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder\",children:media.message||\"Preview unavailable. Use download button to get the full video.\"}):media.type===\"image\"?/*#__PURE__*/_jsx(\"img\",{src:media.preview_url,alt:\"Preview\",className:\"media-element\"}):null,media.username&&/*#__PURE__*/_jsxs(\"p\",{className:\"username\",children:[\"Posted by @\",media.username]}),/*#__PURE__*/_jsx(\"div\",{className:\"download-container\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn success\",onClick:onDownload,children:\"Download\"})})]})]});}","map":{"version":3,"names":["React","useState","jsx","_jsx","jsxs","_jsxs","DownloaderForm","_ref","platform","setPreviewUrl","setPreviewFormat","input","setInput","media","setMedia","loading","setLoading","normalized","setNormalized","normalizeYouTube","url","u","trim","split","replace","test","concat","match","onPreview","alert","res","fetch","encodeURIComponent","json","ok","error","Error","can_preview","preview_url","type","e","message","onDownload","postUrl","a","document","createElement","href","setAttribute","body","appendChild","click","remove","pageUrl","className","children","placeholder","value","onChange","target","onClick","disabled","controls","src","alt","username"],"sources":["C:/Users/Pratik/Downloads/insta-downloader-project/frontend/src/components/DownloaderForm.js"],"sourcesContent":["import React, { useState } from \"react\";\nimport \"./DownloaderForm.css\";\n\nexport default function DownloaderForm({ platform, setPreviewUrl, setPreviewFormat }) {\n  const [input, setInput] = useState(\"\");\n  const [media, setMedia] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [normalized, setNormalized] = useState(\"\"); // keep the normalized URL we used for preview\n\n  const normalizeYouTube = (url) => {\n    let u = url.trim().split(\"?\")[0].replace(/\\/$/, \"\");\n    if (/\\/shorts\\/([^\\/]+)/.test(u)) return `https://www.youtube.com/watch?v=${u.match(/\\/shorts\\/([^\\/]+)/)[1]}`;\n    if (/youtu\\.be\\/([^\\/]+)/.test(u)) return `https://www.youtube.com/watch?v=${u.match(/youtu\\.be\\/([^\\/]+)/)[1]}`;\n    return u;\n  };\n\n  const onPreview = async () => {\n    if (!input.trim()) return alert(\"Please paste a valid link.\");\n    setLoading(true);\n    setMedia(null);\n    setPreviewUrl(\"\");\n    setPreviewFormat(\"\");\n\n    try {\n      let url = input;\n      if (platform === \"youtube\") url = normalizeYouTube(url);\n      setNormalized(url); // remember the exact URL used for backend calls\n\n      const res = await fetch(`http://localhost:3001/api/${platform}?url=${encodeURIComponent(url)}`);\n      const json = await res.json();\n      if (!res.ok || json.error) throw new Error(json.error || \"Preview fetch failed\");\n\n      // Use unified (FastDL-like) response\n      setMedia(json);\n\n      if (json.can_preview && json.preview_url) {\n        setPreviewUrl(json.preview_url);\n        setPreviewFormat(json.type === \"video\" ? \"mp4\" : \"jpg\");\n      }\n    } catch (e) {\n      alert(e.message || \"Preview failed\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const onDownload = () => {\n  if (!media) return;\n\n  if (platform === \"instagram\") {\n    // Always use the original post URL we normalized earlier\n    const postUrl = normalized || input.trim();\n    if (!postUrl) {\n      alert(\"No Instagram post URL available.\");\n      return;\n    }\n\n    const a = document.createElement(\"a\");\n    a.href = `http://localhost:3001/api/instagram/download?url=${encodeURIComponent(postUrl)}&filename=instagram`;\n    a.setAttribute(\"download\", \"\");\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n  } else if (platform === \"youtube\") {\n    // Use the normalized URL we previewed to ensure the backend merges video+audio\n    const pageUrl = normalized || normalizeYouTube(input);\n\n    const a = document.createElement(\"a\");\n    a.href = `http://localhost:3001/api/youtube/download?url=${encodeURIComponent(pageUrl)}&title=InstantSaver`;\n    a.setAttribute(\"download\", \"\");\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n  }\n};\n\n\n  return (\n    <div className=\"downloader-form\">\n      <div className=\"input-row\">\n        <input\n          type=\"text\"\n          placeholder={platform === \"instagram\" ? \"Paste Instagram link\" : \"Paste YouTube link\"}\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          className=\"input-box\"\n        />\n        <button className=\"btn primary\" onClick={onPreview} disabled={loading}>\n          {loading ? \"Loading...\" : \"Preview\"}\n        </button>\n      </div>\n\n      {media && (\n        <div className=\"media-preview\">\n          {media.type === \"video\" ? (\n            media.can_preview ? (\n              <video controls className=\"media-element\">\n                <source src={media.preview_url} type=\"video/mp4\" />\n                Your browser does not support the video tag.\n              </video>\n            ) : (\n              <div className=\"video-placeholder\">\n                {media.message || \"Preview unavailable. Use download button to get the full video.\"}\n              </div>\n            )\n          ) : media.type === \"image\" ? (\n            <img src={media.preview_url} alt=\"Preview\" className=\"media-element\" />\n          ) : null}\n\n          {media.username && <p className=\"username\">Posted by @{media.username}</p>}\n\n          <div className=\"download-container\">\n            <button className=\"btn success\" onClick={onDownload}>\n              Download\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}